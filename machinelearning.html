

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Machine learning &mdash; RamPy 0.6.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=8fa8b3e9"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Maps" href="maps.html" />
    <link rel="prev" title="Peak fitting" href="peakfitting.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            RamPy
              <img src="_static/Rampy.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="news.html">Rampy News</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="firststeps.html">First Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="baseline.html">Baseline</a></li>
<li class="toctree-l1"><a class="reference internal" href="smoothing.html">Smoothing and filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="signalparams.html">Signal parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="peakfitting.html">Peak fitting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Machine learning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#machine-learning-classification">Machine learning classification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rampy.ml_classification"><code class="docutils literal notranslate"><span class="pre">ml_classification</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#machine-learning-exploration">Machine learning exploration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rampy.ml_exploration"><code class="docutils literal notranslate"><span class="pre">ml_exploration</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#machine-learning-regression">Machine learning regression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rampy.ml_regressor"><code class="docutils literal notranslate"><span class="pre">ml_regressor</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#linear-mixture">Linear mixture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rampy.mixing_sp"><code class="docutils literal notranslate"><span class="pre">mixing_sp()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#helper-functions">Helper functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rampy.chemical_splitting"><code class="docutils literal notranslate"><span class="pre">chemical_splitting()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="maps.html">Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="dac.html">Diamond Anvil Cell Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Example notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">rampy API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RamPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Machine learning</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/machinelearning.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="machine-learning">
<h1>Machine learning<a class="headerlink" href="#machine-learning" title="Link to this heading"></a></h1>
<p>Rampy offers three classes for performing classification, regression or unsupervised ML exploration of a set of spectra. Those are helpful ways to automatically perform usual scalling, test-train splitting and ML training of popular ML algorithms, and use <a class="reference external" href="https://scikit-learn.org/stable/">scikit-learn</a> in the background.</p>
<p>Those functions work (<code class="docutils literal notranslate"><span class="pre">rp.regressor</span></code> was used in <a class="reference external" href="https://doi.org/10.2138/am-2019-6887">this publication</a>) but still may evolve in the futur. For advanced, ML, I suggest using directly scikit-learn or other ML libraries.</p>
<p>Below you will find the documentation of the relevant functions, and have a look at the example notebooks too: <a class="reference internal" href="examples.html#rst-notebooks"><span class="std std-ref">Example notebooks</span></a></p>
<p>Do not hesitate to ask for new features depending on your needs !</p>
<section id="machine-learning-classification">
<h2>Machine learning classification<a class="headerlink" href="#machine-learning-classification" title="Link to this heading"></a></h2>
<p>Based on a set of spectra and their labels, the <code class="docutils literal notranslate"><span class="pre">rampy.ml_classification</span></code> module allows you to perform a classification of the spectra using a supervised ML algorithm. The class will take care of splitting the data into training and test sets, scaling the data, and training the model. You can then use the trained model to predict the labels of new spectra.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="rampy.ml_classification">
<span class="sig-prename descclassname"><span class="pre">rampy.</span></span><span class="sig-name descname"><span class="pre">ml_classification</span></span><a class="headerlink" href="#rampy.ml_classification" title="Link to this definition"></a></dt>
<dd><p>alias of &lt;module ‘rampy.ml_classification’ from ‘/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/rampy/ml_classification.py’&gt;</p>
</dd></dl>

</section>
<section id="machine-learning-exploration">
<h2>Machine learning exploration<a class="headerlink" href="#machine-learning-exploration" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">rampy.ml_exploration</span></code> module allows you to perform unsupervised ML exploration of a set of spectra. The class will take care of scaling the data and training the model. You can then use the trained model to explore the data and find patterns.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="rampy.ml_exploration">
<span class="sig-prename descclassname"><span class="pre">rampy.</span></span><span class="sig-name descname"><span class="pre">ml_exploration</span></span><a class="headerlink" href="#rampy.ml_exploration" title="Link to this definition"></a></dt>
<dd><p>alias of &lt;module ‘rampy.ml_exploration’ from ‘/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/rampy/ml_exploration.py’&gt;</p>
</dd></dl>

</section>
<section id="machine-learning-regression">
<h2>Machine learning regression<a class="headerlink" href="#machine-learning-regression" title="Link to this heading"></a></h2>
<p>Based on a set of spectra and their labels, the <code class="docutils literal notranslate"><span class="pre">rampy.ml_regressor</span></code> module allows you to perform a regression using the spectra and a supervised ML algorithm. The class will take care of splitting the data into training and test sets, scaling the data, and training the model. You can then use the trained model to predict the new values of your target from new spectra.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="rampy.ml_regressor">
<span class="sig-prename descclassname"><span class="pre">rampy.</span></span><span class="sig-name descname"><span class="pre">ml_regressor</span></span><a class="headerlink" href="#rampy.ml_regressor" title="Link to this definition"></a></dt>
<dd><p>alias of &lt;module ‘rampy.ml_regressor’ from ‘/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/rampy/ml_regressor.py’&gt;</p>
</dd></dl>

</section>
<section id="linear-mixture">
<h2>Linear mixture<a class="headerlink" href="#linear-mixture" title="Link to this heading"></a></h2>
<p>This function helps you solve a simple problem: you have spectra that are obtained by a linear combination of two endmember spectra.</p>
<p>If you have the two endmember spectra, you can use the <code class="docutils literal notranslate"><span class="pre">rampy.mixing()</span></code> function to know the fraction of each endmember in the mixture.</p>
<p>If you do not know the endmember spectra, then you may be interested in using directly the PyMCR library, see the documentation <a class="reference external" href="https://pages.nist.gov/pyMCR/">here</a> and an example notebook <a class="reference external" href="https://github.com/usnistgov/pyMCR/blob/master/Examples/Demo.ipynb">here</a>. We used it in <a class="reference external" href="https://doi.org/10.2138/am-2019-6887">this publication</a>, see the code <a class="reference external" href="https://github.com/charlesll/rampy/blob/master/examples/Iron_AmMin_paper/Iron_MORB_code.ipynb">here</a>.</p>
<dl class="py function">
<dt class="sig sig-object py" id="rampy.mixing_sp">
<span class="sig-prename descclassname"><span class="pre">rampy.</span></span><span class="sig-name descname"><span class="pre">mixing_sp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_fit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref1</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#rampy.mixing_sp" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Mixes two reference spectra to match given experimental signals.</p>
<p>This function calculates the fractions of the first reference spectrum (<cite>ref1</cite>)
in a linear combination of <cite>ref1</cite> and <cite>ref2</cite> that best matches the provided signals (<cite>y_fit</cite>).
The calculation minimizes the sum of the least absolute values of the objective function:
(  ext{obj} = sum left| y_{      ext{fit}} - (F_1 cdot  ext{ref1} + (1 - F_1) cdot     ext{ref2})</p>
</div></blockquote>
<p>ight| ).</p>
<blockquote>
<div><dl>
<dt>Args:</dt><dd><dl class="simple">
<dt>y_fit (np.ndarray): Array containing the experimental signals with shape <cite>(m, n)</cite>,</dt><dd><p>where <cite>m</cite> is the number of data points and <cite>n</cite> is the number of experiments.</p>
</dd>
</dl>
<p>ref1 (np.ndarray): Array containing the first reference signal with shape <cite>(m,)</cite>.
ref2 (np.ndarray): Array containing the second reference signal with shape <cite>(m,)</cite>.</p>
</dd>
<dt>Returns:</dt><dd><p>np.ndarray: Array of shape <cite>(n,)</cite> containing the fractions of <cite>ref1</cite> in the mix.
Values range between 0 and 1.</p>
</dd>
<dt>Notes:</dt><dd><ul class="simple">
<li><p>The calculation is performed using <cite>cvxpy</cite> for optimization.</p></li>
<li><p>Ensure that <cite>y_fit</cite>, <cite>ref1</cite>, and <cite>ref2</cite> have compatible dimensions.</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fractions</span> <span class="o">=</span> <span class="n">mixing_sp</span><span class="p">(</span><span class="n">y_fit</span><span class="p">,</span> <span class="n">ref1</span><span class="p">,</span> <span class="n">ref2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fractions</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</dd></dl>

</section>
<section id="helper-functions">
<h2>Helper functions<a class="headerlink" href="#helper-functions" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">rampy.chemical_splitting</span></code> function allows you to split datasets depending on a target (e.g. sample composition).</p>
<dl class="py function">
<dt class="sig sig-object py" id="rampy.chemical_splitting">
<span class="sig-prename descclassname"><span class="pre">rampy.</span></span><span class="sig-name descname"><span class="pre">chemical_splitting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Pandas_DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">split_fraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rand_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#rampy.chemical_splitting" title="Link to this definition"></a></dt>
<dd><p>split datasets depending on their chemistry</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Pandas_DataFrame</strong> (<em>Pandas DataFrame</em>) – The input DataFrame with in the first row the names of the different data compositions</p></li>
<li><p><strong>label</strong> (<em>string</em>) – The target in the DataFrame according to which we will split the dataset</p></li>
<li><p><strong>split_fraction</strong> (<em>float</em><em>, </em><em>between 0 and 1</em>) – This is the amount of splitting you want, in reference to the second output dataset (see OUTPUTS).</p></li>
<li><p><strong>rand_state</strong> (<em>float64</em>) – the random seed that is used for reproductibility of the results. Default = 42.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>frame1</strong> (<em>Pandas DataFrame</em>) – A DataSet with (1-split_fraction) datas from the input dataset with unique chemical composition / names</p></li>
<li><p><strong>frame2</strong> (<em>Pandas DataFrame</em>) – A DataSet with split_fraction datas from the input dataset with unique chemical composition / names</p></li>
<li><p><strong>frame1_idx</strong> (<em>ndarray</em>) – Contains the indexes of the data picked in Pandas_DataFrame to construct frame1</p></li>
<li><p><strong>frame2_idx</strong> (<em>ndarray</em>) – Contains the indexes of the data picked in Pandas_DataFrame to construct frame2</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function avoids the same chemical dataset to be found in different training/testing/validating datasets that are used in ML.</p>
<p>Indeed, it is worthless to put data from the same original dataset / with the same chemical composition
in the training / testing / validating datasets. This creates a initial bias in the splitting process…</p>
<p>Another way of doing that would be to write:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">grouped</span> <span class="o">=</span> <span class="n">Pandas_DataFrame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">grouped</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">k_train</span><span class="p">,</span> <span class="n">k_valid</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.40</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">train</span> <span class="o">=</span> <span class="n">Pandas_DataFrame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Pandas_DataFrame</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">k_train</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">valid</span> <span class="o">=</span> <span class="n">Pandas_DataFrame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Pandas_DataFrame</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">k_valid</span><span class="p">)]</span>
</pre></div>
</div>
<p>(results will vary slightly as variable k is sorted but not variable names in the function below)</p>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="peakfitting.html" class="btn btn-neutral float-left" title="Peak fitting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="maps.html" class="btn btn-neutral float-right" title="Maps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Charles Le Losq.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>